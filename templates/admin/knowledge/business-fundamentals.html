{% extends "admin/base.html" %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<style>
    .biz-container {
        display: flex;
        height: calc(100vh - 100px);
    }
    .biz-sidebar { width: 250px; border-right: 1px solid #ddd; overflow-y: auto; padding: 20px; }
    .biz-main { flex: 1; display: flex; flex-direction: column; }
    .biz-header { background: white; border-bottom: 1px solid #ddd; padding: 20px; }
    .biz-content { flex: 1; overflow-y: auto; padding: 20px; }
    .biz-preview { width: 300px; border-left: 1px solid #ddd; overflow-y: auto; padding: 20px; background: #f8f9fa; display: none; }
    .search-box { position: relative; }
    .suggestions { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ddd; border-top: none; display: none; max-height: 300px; overflow-y: auto; z-index: 1000; }
    .suggestions.show { display: block; }
    .suggestion-item { padding: 10px 15px; cursor: pointer; border-bottom: 1px solid #eee; }
    .suggestion-item:hover { background: #f0f0f0; }
    .doc-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 15px; cursor: pointer; transition: all 0.3s; }
    .doc-card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .doc-card.low-quality { border-left: 3px solid #dc3545; }
    .doc-card.med-quality { border-left: 3px solid #ffc107; }
    .doc-card.high-quality { border-left: 3px solid #28a745; }
    .quality-circle { width: 20px; height: 20px; border-radius: 50%; display: inline-block; }
    .quality-high { background: #28a745; }
    .quality-medium { background: #ffc107; }
    .quality-low { background: #dc3545; }
    .view-toggle { display: flex; gap: 10px; }
    .view-toggle button { padding: 5px 10px; border: 1px solid #ddd; background: white; cursor: pointer; border-radius: 4px; }
    .view-toggle button.active { background: #007bff; color: white; border-color: #007bff; }
    .grid-view { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
    .doc-grid-item { border: 1px solid #ddd; border-radius: 8px; padding: 15px; text-align: center; }
    .tag { display: inline-block; background: #e9ecef; color: #495057; padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; margin-right: 5px; }
    .empty-state { text-align: center; padding: 40px; color: #999; }
    .step-indicator { display: flex; justify-content: space-between; margin-bottom: 20px; }
    .step { text-align: center; flex: 1; }
    .step.active { color: #007bff; font-weight: bold; }
    .step.done::before { content: 'âœ“'; color: #28a745; font-weight: bold; }
    .progress-step { background: #e9ecef; padding: 10px; border-radius: 4px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
    .progress-step.done { background: #d4edda; }
    .progress-step.done::before { content: 'âœ“'; color: #28a745; font-weight: bold; }
</style>

<div class="biz-container">
    <!-- Sidebar Navigation -->
    <div class="biz-sidebar">
        <h5 class="mb-4">ğŸ“š Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</h5>
        <div class="nav flex-column">
            <a href="#" class="nav-link active px-0 mb-2">ğŸ“„ Ø§Ù„Ù…Ù„ÙØ§Øª</a>
            <a href="#" class="nav-link px-0 mb-2" onclick="showCategory('definitions')">ğŸ“– Ø§Ù„ØªØ¹Ø±ÙŠÙØ§Øª</a>
            <a href="#" class="nav-link px-0 mb-2" onclick="showCategory('frameworks')">ğŸ¯ Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª</a>
            <a href="#" class="nav-link px-0 mb-2" onclick="showCategory('guides')">ğŸ“š Ø§Ù„Ø£Ø¯Ù„Ø©</a>
            <a href="#" class="nav-link px-0 mb-2" onclick="showCategory('templates')">ğŸ“‹ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨</a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="biz-main">
        <!-- Top Bar -->
        <div class="biz-header">
            <div class="row align-items-center mb-3">
                <div class="col-md-8">
                    <h4 class="mb-0">ğŸ“š Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ - Business Fundamentals</h4>
                </div>
                <div class="col-md-4 text-end">
                    <div class="view-toggle">
                        <button class="active" onclick="switchView('list')" title="List View">
                            <i class="fas fa-list"></i>
                        </button>
                        <button onclick="switchView('grid')" title="Grid View">
                            <i class="fas fa-th"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Search Bar -->
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <div class="search-box">
                        <input type="text" class="form-control" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø£Ø¹Ù…Ø§Ù„â€¦" autocomplete="off">
                        <div class="suggestions" id="suggestions"></div>
                    </div>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="filterType">
                        <option value="">Ø§Ù„Ù†ÙˆØ¹</option>
                        <option value="pdf">PDF</option>
                        <option value="docx">DOCX</option>
                        <option value="template">Template</option>
                        <option value="notes">Notes</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="filterQuality">
                        <option value="">Ø§Ù„Ø¬ÙˆØ¯Ø©</option>
                        <option value="high">Ø¹Ø§Ù„ÙŠØ©</option>
                        <option value="medium">Ù…ØªÙˆØ³Ø·Ø©</option>
                        <option value="low">Ù…Ù†Ø®ÙØ¶Ø©</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="sortBy">
                        <option value="recent">Ø§Ù„Ø£Ø­Ø¯Ø«</option>
                        <option value="oldest">Ø§Ù„Ø£Ù‚Ø¯Ù…</option>
                        <option value="quality">Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø¬ÙˆØ¯Ø©</option>
                        <option value="name">Ø§Ù„Ø£Ø¨Ø¬Ø¯ÙŠ</option>
                    </select>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="row">
                <div class="col-md-12">
                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#uploadModal">
                        <i class="fas fa-cloud-upload-alt"></i> Ø±ÙØ¹ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯
                    </button>
                    <button class="btn btn-danger btn-sm" id="bulkDeleteBtn" style="display:none;">
                        <i class="fas fa-trash"></i> Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯
                    </button>
                    <button class="btn btn-warning btn-sm" id="bulkReprocessBtn" style="display:none;">
                        <i class="fas fa-sync"></i> Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø¹Ø§Ù„Ø¬Ø©
                    </button>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="biz-content">
            <div id="listView">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th style="width: 30px;"><input type="checkbox" id="selectAll"></th>
                                <th>ğŸ“„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„ÙˆØ³ÙˆÙ…</th>
                                <th>Ø§Ù„Ø¬ÙˆØ¯Ø©</th>
                                <th>Ø§Ù„Ø­Ø¬Ù…</th>
                                <th>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="documentsList"></tbody>
                    </table>
                </div>
                <div id="emptyState" class="empty-state" style="display:none;">
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªÙ†Ø¯Ø§Øª ÙÙŠ Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø£Ø¹Ù…Ø§Ù„.</p>
                    <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#uploadModal">
                        ğŸ“¤ Ø±ÙØ¹ Ù…Ù„ÙÙƒ Ø§Ù„Ø£ÙˆÙ„
                    </button>
                </div>
            </div>

            <div id="gridView" style="display:none;" class="grid-view"></div>
        </div>
    </div>

    <!-- Preview Panel -->
    <div class="biz-preview" id="previewPanel">
        <button class="btn btn-sm btn-outline-secondary mb-3 w-100" onclick="closePreview()">
            <i class="fas fa-times"></i> Ø¥ØºÙ„Ø§Ù‚
        </button>
        <div id="previewContent"></div>
    </div>
</div>

<!-- Upload Modal -->
<div class="modal fade" id="uploadModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ğŸ“¤ Ø±ÙØ¹ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯ - Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Step Indicator -->
                <div class="step-indicator mb-4">
                    <div class="step active">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù</div>
                    <div class="step">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</div>
                    <div class="step">Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</div>
                    <div class="step">Ø§Ù„ØªØ£ÙƒÙŠØ¯</div>
                </div>

                <!-- Step 1: File Upload -->
                <div id="step1">
                    <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù</label>
                    <input type="file" class="form-control mb-3" id="fileInput" accept=".pdf,.docx,.txt,.md,.doc">
                    <small class="text-muted">Ø£Ù†ÙˆØ§Ø¹ Ù…Ø¯Ø¹ÙˆÙ…Ø©: PDF, DOCX, TXT, Markdown</small>
                </div>

                <!-- Step 2: Basic Info -->
                <div id="step2" style="display:none;">
                    <div class="mb-3">
                        <label class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                        <input type="text" class="form-control" id="docTitle">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Ø§Ù„ÙˆØµÙ</label>
                        <textarea class="form-control" id="docDesc" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Ø§Ù„Ù†ÙˆØ¹</label>
                        <select class="form-select" id="docType">
                            <option value="Reference">Ù…Ø±Ø¬Ø¹</option>
                            <option value="Framework">Ø¥Ø·Ø§Ø± Ø¹Ù…Ù„</option>
                            <option value="Guide">Ø¯Ù„ÙŠÙ„</option>
                            <option value="Definition">ØªØ¹Ø±ÙŠÙ</option>
                            <option value="Template">Ù‚Ø§Ù„Ø¨</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Ø§Ù„ÙˆØ³ÙˆÙ… (ÙØµÙ„ Ø¨ÙÙˆØ§ØµÙ„)</label>
                        <input type="text" class="form-control" id="docTags" placeholder="Market, Strategy, Finance">
                    </div>
                </div>

                <!-- Step 3: Processing -->
                <div id="step3" style="display:none;">
                    <div class="progress-step done">
                        <span>Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ</span>
                    </div>
                    <div class="progress-step done">
                        <span>ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</span>
                    </div>
                    <div class="progress-step">
                        <span>ØªÙ‚Ø³ÙŠÙ… Chunks</span>
                        <div class="spinner-border spinner-border-sm ms-auto" role="status"></div>
                    </div>
                    <div class="progress-step">
                        <span>Ø¥Ù†Ø´Ø§Ø¡ Embeddings</span>
                    </div>
                    <div class="progress-step">
                        <span>ÙØ­Øµ Ø§Ù„Ø¬ÙˆØ¯Ø©</span>
                    </div>
                    <div class="progress-step">
                        <span>ÙƒØ´Ù Ø§Ù„ØªÙƒØ±Ø§Ø±</span>
                    </div>
                </div>

                <!-- Step 4: Confirm -->
                <div id="step4" style="display:none;">
                    <div class="alert alert-success">
                        <strong>âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­!</strong>
                        <p class="mb-0 mt-2">ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù ÙÙŠ Ù‚Ø³Ù… Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø£Ø¹Ù…Ø§Ù„.</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextStep()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
                <button type="button" class="btn btn-success" id="uploadBtnFinal" onclick="finalUpload()" style="display:none;">Ø­ÙØ¸ ÙÙŠ Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
<script>
let currentStep = 1;
let selectedDocs = new Set();
const suggestions = ['ROI', 'Business Model Canvas', 'McKinsey 7S', 'Porter 5 Forces', 'SWOT', 'Break-even', 'Market Size', 'CAC', 'CLV'];

const sampleDocs = [
    { id: 1, title: 'Business Model Canvas', type: 'Framework', tags: ['Business', 'Model'], quality: 'high', date: '2025-11-26', size: '2.5 MB' },
    { id: 2, title: 'ROI Calculator', type: 'Template', tags: ['Finance', 'ROI'], quality: 'high', date: '2025-11-25', size: '1.2 MB' },
    { id: 3, title: 'Market Size Analysis', type: 'Guide', tags: ['Market', 'Strategy'], quality: 'medium', date: '2025-11-24', size: '3.1 MB' },
];

document.addEventListener('DOMContentLoaded', () => {
    renderDocuments();
    setupSearch();
    setupFilters();
});

function renderDocuments() {
    const tbody = document.getElementById('documentsList');
    const gridView = document.getElementById('gridView');
    tbody.innerHTML = '';
    gridView.innerHTML = '';
    
    if (sampleDocs.length === 0) {
        document.getElementById('emptyState').style.display = 'block';
        return;
    }
    
    sampleDocs.forEach(doc => {
        const qualityClass = doc.quality === 'high' ? 'high-quality' : doc.quality === 'medium' ? 'med-quality' : 'low-quality';
        const qualityCircle = `<span class="quality-circle quality-${doc.quality}"></span>`;
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><input type="checkbox" class="doc-checkbox" value="${doc.id}"></td>
            <td><a href="#" onclick="showPreview(${doc.id})"><strong>${doc.title}</strong></a></td>
            <td><span class="badge bg-secondary">${doc.type}</span></td>
            <td>${doc.tags.map(t => `<span class="tag">${t}</span>`).join('')}</td>
            <td>${qualityCircle}</td>
            <td>${doc.size}</td>
            <td>${doc.date}</td>
            <td>
                <div class="btn-group btn-group-sm" role="group">
                    <button class="btn btn-info" onclick="showPreview(${doc.id})"><i class="fas fa-eye"></i></button>
                    <button class="btn btn-warning" onclick="editMetadata(${doc.id})"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-danger" onclick="deleteDocument(${doc.id})"><i class="fas fa-trash"></i></button>
                </div>
            </td>
        `;
        tbody.appendChild(row);
    });
}

function setupSearch() {
    const input = document.getElementById('searchInput');
    const suggestionsDiv = document.getElementById('suggestions');
    
    input.addEventListener('focus', () => {
        suggestionsDiv.innerHTML = suggestions.map(s => `<div class="suggestion-item" onclick="selectSuggestion('${s}')">${s}</div>`).join('');
        suggestionsDiv.classList.add('show');
    });
    
    input.addEventListener('input', (e) => {
        const val = e.target.value.toLowerCase();
        const filtered = suggestions.filter(s => s.toLowerCase().includes(val));
        suggestionsDiv.innerHTML = filtered.map(s => `<div class="suggestion-item" onclick="selectSuggestion('${s}')">${s}</div>`).join('');
    });
    
    document.addEventListener('click', (e) => {
        if (!input.contains(e.target)) suggestionsDiv.classList.remove('show');
    });
}

function selectSuggestion(text) {
    document.getElementById('searchInput').value = text;
    document.getElementById('suggestions').classList.remove('show');
}

function setupFilters() {
    document.getElementById('filterType').addEventListener('change', renderDocuments);
    document.getElementById('filterQuality').addEventListener('change', renderDocuments);
    document.getElementById('sortBy').addEventListener('change', renderDocuments);
}

function switchView(view) {
    document.getElementById('listView').style.display = view === 'list' ? 'block' : 'none';
    document.getElementById('gridView').style.display = view === 'grid' ? 'grid' : 'none';
    if (view === 'grid') renderGridView();
}

function renderGridView() {
    const grid = document.getElementById('gridView');
    grid.innerHTML = sampleDocs.map(doc => `
        <div class="doc-grid-item">
            <h6>${doc.title}</h6>
            <p class="text-muted small">${doc.tags.join(', ')}</p>
            <button class="btn btn-sm btn-primary" onclick="showPreview(${doc.id})">Ø¹Ø±Ø¶</button>
        </div>
    `).join('');
}

function showPreview(id) {
    const panel = document.getElementById('previewPanel');
    const content = document.getElementById('previewContent');
    const doc = sampleDocs.find(d => d.id === id);
    
    content.innerHTML = `
        <h5>${doc.title}</h5>
        <p class="text-muted">${doc.type}</p>
        <div class="mb-3">${doc.tags.map(t => `<span class="tag">${t}</span>`).join('')}</div>
        <p>Ø§Ù„Ø­Ø¬Ù…: ${doc.size}</p>
        <p>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${doc.date}</p>
    `;
    panel.style.display = 'block';
}

function closePreview() {
    document.getElementById('previewPanel').style.display = 'none';
}

function editMetadata(id) {
    Swal.fire('Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø±Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØµÙÙŠØ© Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'info');
}

function deleteDocument(id) {
    Swal.fire({
        icon: 'question',
        title: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù',
        text: 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„ÙØŸ',
        showCancelButton: true,
        confirmButtonText: 'Ù†Ø¹Ù…',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
    }).then(r => r.isConfirmed && Swal.fire('ØªÙ… Ø§Ù„Ø­Ø°Ù', '', 'success').then(() => location.reload()));
}

function nextStep() {
    currentStep++;
    document.querySelectorAll('[id^="step"]').forEach(e => e.style.display = 'none');
    document.getElementById(`step${currentStep}`).style.display = 'block';
    
    if (currentStep === 4) {
        document.getElementById('nextBtn').style.display = 'none';
        document.getElementById('uploadBtnFinal').style.display = 'inline-block';
    }
}

function finalUpload() {
    Swal.fire('Ù†Ø¬Ø§Ø­!', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­', 'success').then(() => location.reload());
}

function showCategory(cat) {
    renderDocuments();
}
</script>
{% endblock %}
