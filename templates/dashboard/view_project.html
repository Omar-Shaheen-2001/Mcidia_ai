{% extends "base.html" %}

{% block title %}{{ project.title }} - Mcidia{% endblock %}

{% block content %}
<!-- Header -->
<section class="bg-gradient-primary text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="fw-bold mb-2">
                    <i class="fas fa-folder me-2"></i>
                    {{ project.title }}
                </h1>
                <p class="mb-0 text-white-50">
                    {% if project_services.service %}
                        {{ project_services.service.title_ar if lang == 'ar' else project_services.service.title_en }} / 
                        {{ project_services.offering.title_ar if lang == 'ar' else project_services.offering.title_en }}
                    {% else %}
                        {{ project.module }}
                    {% endif %}
                </p>
            </div>
            <div class="col-md-4 text-md-end mt-3 mt-md-0">
                <a href="{{ url_for('dashboard.all_projects') }}" class="btn btn-light me-2">
                    <i class="fas fa-arrow-{{ 'right' if lang == 'ar' else 'left' }} me-2"></i>
                    {{ 'العودة' if lang == 'ar' else 'Back' }}
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<div class="container my-5">
    <div class="row">
        <!-- Project Details -->
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">{{ 'تفاصيل المشروع' if lang == 'ar' else 'Project Details' }}</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="fw-bold text-muted small">{{ 'حالة المشروع' if lang == 'ar' else 'Status' }}</label>
                            <p>
                                {% if project.status == 'draft' %}
                                    <span class="badge bg-warning text-dark"><i class="fas fa-pencil me-1"></i>{{ 'مسودة' if lang == 'ar' else 'Draft' }}</span>
                                {% elif project.status == 'completed' %}
                                    <span class="badge bg-success"><i class="fas fa-check me-1"></i>{{ 'مكتمل' if lang == 'ar' else 'Completed' }}</span>
                                {% elif project.status == 'archived' %}
                                    <span class="badge bg-secondary"><i class="fas fa-archive me-1"></i>{{ 'مؤرشف' if lang == 'ar' else 'Archived' }}</span>
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <label class="fw-bold text-muted small">{{ 'تاريخ الإنشاء' if lang == 'ar' else 'Created' }}</label>
                            <p>{{ project.created_at.strftime('%d-%m-%Y %H:%M') if project.created_at else 'N/A' }}</p>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="fw-bold text-muted small">{{ 'آخر تحديث' if lang == 'ar' else 'Updated' }}</label>
                            <p>{{ project.updated_at.strftime('%d-%m-%Y %H:%M') if project.updated_at else 'N/A' }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="fw-bold text-muted small">{{ 'الوحدة' if lang == 'ar' else 'Module' }}</label>
                            <p>{{ project.module }}</p>
                        </div>
                    </div>
                    <hr>
                    <label class="fw-bold text-muted small">{{ 'المحتوى' if lang == 'ar' else 'Content' }}</label>
                    <div class="bg-light p-3 rounded">
                        <pre style="white-space: pre-wrap; word-wrap: break-word; max-height: 300px; overflow-y: auto;">{{ project.content[:1000] if project.content else 'No content' }}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Actions -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">{{ 'الإجراءات' if lang == 'ar' else 'Actions' }}</h5>
                </div>
                <div class="card-body">
                    <a href="{{ url_for('dashboard.edit_project', project_id=project.id) }}" class="btn btn-primary w-100 mb-2">
                        <i class="fas fa-edit me-2"></i>{{ 'تعديل المشروع' if lang == 'ar' else 'Edit Project' }}
                    </a>
                    <button class="btn btn-outline-danger w-100" onclick="deleteProject({{ project.id }})">
                        <i class="fas fa-trash me-2"></i>{{ 'حذف المشروع' if lang == 'ar' else 'Delete Project' }}
                    </button>
                </div>
            </div>

            <!-- Service Info -->
            {% if project_services.service %}
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0">{{ 'معلومات الخدمة' if lang == 'ar' else 'Service Info' }}</h5>
                </div>
                <div class="card-body">
                    <label class="fw-bold text-muted small">{{ 'الخدمة' if lang == 'ar' else 'Service' }}</label>
                    <p class="mb-3">
                        <span class="badge bg-primary">
                            <i class="{{ project_services.service.icon }} me-1"></i>
                            {{ project_services.service.title_ar if lang == 'ar' else project_services.service.title_en }}
                        </span>
                    </p>
                    
                    <label class="fw-bold text-muted small">{{ 'الوحدة الفرعية' if lang == 'ar' else 'Offering' }}</label>
                    <p>{{ project_services.offering.title_ar if lang == 'ar' else project_services.offering.title_en }}</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.all.min.js"></script>

<script>
function deleteProject(projectId) {
    Swal.fire({
        title: '{{ "تأكيد الحذف" if lang == "ar" else "Confirm Delete" }}',
        text: '{{ "هل أنت متأكد من حذف هذا المشروع؟ هذا الإجراء لا يمكن التراجع عنه." if lang == "ar" else "Are you sure you want to delete this project? This action cannot be undone." }}',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#dc3545',
        cancelButtonColor: '#6c757d',
        confirmButtonText: '{{ "نعم، احذف المشروع" if lang == "ar" else "Yes, Delete Project" }}',
        cancelButtonText: '{{ "إلغاء" if lang == "ar" else "Cancel" }}'
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/api/project/${projectId}/delete`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        title: '{{ "تم الحذف بنجاح" if lang == "ar" else "Deleted Successfully" }}',
                        text: '{{ "تم حذف المشروع بنجاح" if lang == "ar" else "Project has been deleted successfully" }}',
                        icon: 'success',
                        confirmButtonColor: '#0A2756'
                    }).then(() => {
                        window.location.href = '{{ url_for("dashboard.all_projects") }}';
                    });
                } else {
                    Swal.fire({
                        title: '{{ "خطأ" if lang == "ar" else "Error" }}',
                        text: data.error || '{{ "حدث خطأ أثناء حذف المشروع" if lang == "ar" else "Error deleting project" }}',
                        icon: 'error',
                        confirmButtonColor: '#0A2756'
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
                Swal.fire({
                    title: '{{ "خطأ" if lang == "ar" else "Error" }}',
                    text: '{{ "حدث خطأ في الاتصال" if lang == "ar" else "Connection error" }}',
                    icon: 'error',
                    confirmButtonColor: '#0A2756'
                });
            });
        }
    });
}
</script>
{% endblock %}
