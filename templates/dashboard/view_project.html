{% extends "base.html" %}

{% block title %}{{ project.title }} - Mcidia{% endblock %}

{% block extra_css %}
<style>
    .content-display {
        font-size: 16px;
        line-height: 1.8;
        color: #333;
    }
    
    .content-display h1,
    .content-display h2,
    .content-display h3,
    .content-display h4,
    .content-display h5,
    .content-display h6 {
        margin-top: 1.5rem;
        margin-bottom: 1rem;
        font-weight: 600;
        color: #0A2756;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 0.5rem;
    }
    
    .content-display h1 {
        font-size: 2rem;
    }
    
    .content-display h2 {
        font-size: 1.75rem;
    }
    
    .content-display h3 {
        font-size: 1.5rem;
    }
    
    .content-display p {
        margin-bottom: 1rem;
        text-align: justify;
    }
    
    .content-display ul,
    .content-display ol {
        margin-left: 2rem;
        margin-bottom: 1rem;
    }
    
    .content-display li {
        margin-bottom: 0.5rem;
        line-height: 1.6;
    }
    
    .content-display table {
        width: 100%;
        border-collapse: collapse;
        margin: 1.5rem 0;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .content-display table th {
        background-color: #0A2756;
        color: white;
        padding: 1rem;
        text-align: right;
        font-weight: 600;
    }
    
    .content-display table td {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .content-display table tbody tr:hover {
        background-color: #f9f9f9;
    }
    
    .content-display blockquote {
        border-left: 4px solid #0A2756;
        padding-left: 1rem;
        margin: 1.5rem 0;
        color: #666;
        background-color: #f5f5f5;
        padding: 1rem;
    }
    
    .content-display strong,
    .content-display b {
        font-weight: 700;
        color: #0A2756;
    }
    
    .content-display em,
    .content-display i {
        font-style: italic;
        color: #555;
    }
    
    .content-display a {
        color: #2767B1;
        text-decoration: none;
        border-bottom: 1px dotted #2767B1;
    }
    
    .content-display a:hover {
        border-bottom: 1px solid #2767B1;
    }
    
    .content-display hr {
        margin: 2rem 0;
        border: none;
        border-top: 2px solid #e0e0e0;
    }
    
    .content-display code {
        background-color: #f4f4f4;
        padding: 0.2rem 0.4rem;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
        color: #d63384;
    }
    
    .content-display pre {
        background-color: #f4f4f4;
        padding: 1rem;
        border-radius: 4px;
        overflow-x: auto;
        margin: 1rem 0;
        border-left: 4px solid #0A2756;
    }
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<section class="bg-gradient-primary text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="fw-bold mb-2">
                    <i class="fas fa-folder me-2"></i>
                    {{ project.title }}
                </h1>
                <p class="mb-0 text-white-50">
                    {% if project_services.service %}
                        {{ project_services.service.title_ar if lang == 'ar' else project_services.service.title_en }} / 
                        {{ project_services.offering.title_ar if lang == 'ar' else project_services.offering.title_en }}
                    {% else %}
                        {{ project.module }}
                    {% endif %}
                </p>
            </div>
            <div class="col-md-4 text-md-end mt-3 mt-md-0">
                <a href="{{ url_for('dashboard.all_projects') }}" class="btn btn-light me-2">
                    <i class="fas fa-arrow-{{ 'right' if lang == 'ar' else 'left' }} me-2"></i>
                    {{ 'العودة' if lang == 'ar' else 'Back' }}
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<div class="container my-5">
    <div class="row">
        <!-- Project Details -->
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">{{ 'تفاصيل المشروع' if lang == 'ar' else 'Project Details' }}</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="fw-bold text-muted small">{{ 'حالة المشروع' if lang == 'ar' else 'Status' }}</label>
                            <p>
                                {% if project.status == 'draft' %}
                                    <span class="badge bg-warning text-dark"><i class="fas fa-pencil me-1"></i>{{ 'مسودة' if lang == 'ar' else 'Draft' }}</span>
                                {% elif project.status == 'completed' %}
                                    <span class="badge bg-success"><i class="fas fa-check me-1"></i>{{ 'مكتمل' if lang == 'ar' else 'Completed' }}</span>
                                {% elif project.status == 'archived' %}
                                    <span class="badge bg-secondary"><i class="fas fa-archive me-1"></i>{{ 'مؤرشف' if lang == 'ar' else 'Archived' }}</span>
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <label class="fw-bold text-muted small">{{ 'تاريخ الإنشاء' if lang == 'ar' else 'Created' }}</label>
                            <p>{{ project.created_at.strftime('%d-%m-%Y %H:%M') if project.created_at else 'N/A' }}</p>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="fw-bold text-muted small">{{ 'آخر تحديث' if lang == 'ar' else 'Updated' }}</label>
                            <p>{{ project.updated_at.strftime('%d-%m-%Y %H:%M') if project.updated_at else 'N/A' }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="fw-bold text-muted small">{{ 'الوحدة' if lang == 'ar' else 'Module' }}</label>
                            <p>{{ project.module }}</p>
                        </div>
                    </div>
                    <hr class="my-4">
                    <label class="fw-bold text-muted small mb-4 d-block">{{ 'المحتوى' if lang == 'ar' else 'Content' }}</label>
                    <div class="content-display border rounded-lg p-5" style="background-color: #fafafa; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        {% if project.content %}
                            {{ project.content|md_to_html|safe }}
                        {% else %}
                            <p class="text-muted text-center py-5">
                                <i class="fas fa-file-alt fa-2x mb-3 d-block text-muted"></i>
                                {{ 'لا يوجد محتوى' if lang == 'ar' else 'No content' }}
                            </p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Actions -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">{{ 'الإجراءات' if lang == 'ar' else 'Actions' }}</h5>
                </div>
                <div class="card-body">
                    <a href="{{ url_for('dashboard.edit_project', project_id=project.id) }}" class="btn btn-primary w-100 mb-2">
                        <i class="fas fa-edit me-2"></i>{{ 'تعديل المشروع' if lang == 'ar' else 'Edit Project' }}
                    </a>
                    <button class="btn btn-outline-danger w-100" onclick="deleteProject({{ project.id }})">
                        <i class="fas fa-trash me-2"></i>{{ 'حذف المشروع' if lang == 'ar' else 'Delete Project' }}
                    </button>
                </div>
            </div>

            <!-- Service Info -->
            {% if project_services.service %}
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0">{{ 'معلومات الخدمة' if lang == 'ar' else 'Service Info' }}</h5>
                </div>
                <div class="card-body">
                    <label class="fw-bold text-muted small">{{ 'الخدمة' if lang == 'ar' else 'Service' }}</label>
                    <p class="mb-3">
                        <span class="badge bg-primary">
                            <i class="{{ project_services.service.icon }} me-1"></i>
                            {{ project_services.service.title_ar if lang == 'ar' else project_services.service.title_en }}
                        </span>
                    </p>
                    
                    <label class="fw-bold text-muted small">{{ 'الوحدة الفرعية' if lang == 'ar' else 'Offering' }}</label>
                    <p>{{ project_services.offering.title_ar if lang == 'ar' else project_services.offering.title_en }}</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.all.min.js"></script>

<script>
function deleteProject(projectId) {
    Swal.fire({
        title: '{{ "تأكيد الحذف" if lang == "ar" else "Confirm Delete" }}',
        text: '{{ "هل أنت متأكد من حذف هذا المشروع؟ هذا الإجراء لا يمكن التراجع عنه." if lang == "ar" else "Are you sure you want to delete this project? This action cannot be undone." }}',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#dc3545',
        cancelButtonColor: '#6c757d',
        confirmButtonText: '{{ "نعم، احذف المشروع" if lang == "ar" else "Yes, Delete Project" }}',
        cancelButtonText: '{{ "إلغاء" if lang == "ar" else "Cancel" }}'
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/dashboard/api/project/${projectId}/delete`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        title: '{{ "تم الحذف بنجاح" if lang == "ar" else "Deleted Successfully" }}',
                        text: '{{ "تم حذف المشروع بنجاح" if lang == "ar" else "Project has been deleted successfully" }}',
                        icon: 'success',
                        confirmButtonColor: '#0A2756'
                    }).then(() => {
                        window.location.href = '{{ url_for("dashboard.all_projects") }}';
                    });
                } else {
                    Swal.fire({
                        title: '{{ "خطأ" if lang == "ar" else "Error" }}',
                        text: data.error || '{{ "حدث خطأ أثناء حذف المشروع" if lang == "ar" else "Error deleting project" }}',
                        icon: 'error',
                        confirmButtonColor: '#0A2756'
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
                Swal.fire({
                    title: '{{ "خطأ" if lang == "ar" else "Error" }}',
                    text: '{{ "حدث خطأ في الاتصال" if lang == "ar" else "Connection error" }}',
                    icon: 'error',
                    confirmButtonColor: '#0A2756'
                });
            });
        }
    });
}
</script>
{% endblock %}
