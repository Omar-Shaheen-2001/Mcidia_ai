{% extends "base.html" %}

{% block title %}{{ 'لوحة التحكم' if lang == 'ar' else 'Dashboard' }} - Mcidia{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<section class="bg-gradient-primary text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="fw-bold mb-2 text-white">
                    <i class="fas fa-hand-wave me-2"></i>
                    {{ 'مرحباً' if lang == 'ar' else 'Welcome back' }}, {{ user.username }}!
                </h1>
                <p class="mb-0 text-white-50">
                    {{ 'إليك ملخص نشاطك وأدواتك الاستشارية الذكية' if lang == 'ar' else 'Here is your activity summary and smart consulting tools' }}
                </p>
            </div>
            <div class="col-md-4 text-md-end mt-3 mt-md-0">
                <a href="{{ url_for('consultation.index') }}" class="btn btn-light btn-lg">
                    <i class="fas fa-comments me-2"></i>
                    {{ 'استشارة فورية' if lang == 'ar' else 'Quick Consultation' }}
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Main Dashboard Content -->
<div class="container my-5">
    <!-- Statistics Cards -->
    <div class="row g-4 mb-5">
        <!-- Active Projects Card -->
        <div class="col-lg-3 col-md-6">
            <div class="card card--stat hover-lift h-100">
                <div class="card__body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="icon-box icon-box--primary" style="background-color: rgba(255,255,255,0.2);">
                            <i class="fas fa-folder-open text-white"></i>
                        </div>
                        <span class="badge badge--success">
                            <i class="fas fa-arrow-up me-1"></i>
                            +12%
                        </span>
                    </div>
                    <h3 class="card__title text-white">{{ active_projects }}</h3>
                    <p class="card__description">
                        {{ 'المشاريع النشطة' if lang == 'ar' else 'Active Projects' }}
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Total Projects Card -->
        <div class="col-lg-3 col-md-6">
            <div class="card hover-lift h-100" style="background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-secondary-light) 100%);">
                <div class="card__body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="icon-box icon-box--secondary" style="background-color: rgba(255,255,255,0.2);">
                            <i class="fas fa-check-circle text-white"></i>
                        </div>
                        <span class="badge" style="background-color: rgba(255,255,255,0.2); color: white;">
                            {{ 'الكل' if lang == 'ar' else 'All' }}
                        </span>
                    </div>
                    <h3 class="card__title text-white">{{ total_projects }}</h3>
                    <p class="card__description text-white">
                        {{ 'إجمالي المشاريع' if lang == 'ar' else 'Total Projects' }}
                    </p>
                </div>
            </div>
        </div>
        
        <!-- AI Credits Card -->
        <div class="col-lg-3 col-md-6">
            <div class="card hover-lift h-100" style="background: linear-gradient(135deg, var(--color-active) 0%, #1F5291 100%);">
                <div class="card__body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="icon-box" style="background-color: rgba(255,255,255,0.2);">
                            <i class="fas fa-brain text-white"></i>
                        </div>
                        <span class="badge" style="background-color: rgba(255,255,255,0.2); color: white;">
                            AI
                        </span>
                    </div>
                    <h3 class="card__title text-white">{{ ai_credits }}</h3>
                    <p class="card__description text-white">
                        {{ 'استخدام الذكاء الاصطناعي' if lang == 'ar' else 'AI Credits Used' }}
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Subscription Card -->
        <div class="col-lg-3 col-md-6">
            <div class="card hover-lift h-100" style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);">
                <div class="card__body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="icon-box" style="background-color: rgba(255,255,255,0.2);">
                            <i class="fas fa-crown text-white"></i>
                        </div>
                        <a href="{{ url_for('billing.pricing') }}" class="text-white text-decoration-none">
                            <i class="fas fa-arrow-{{ 'left' if lang == 'ar' else 'right' }}"></i>
                        </a>
                    </div>
                    <h3 class="card__title text-white">{{ user.subscription_plan or 'Free' }}</h3>
                    <p class="card__description text-white">
                        {{ 'الباقة الحالية' if lang == 'ar' else 'Current Plan' }}
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Consultations Card -->
        <div class="col-lg-3 col-md-6">
            <div class="card hover-lift h-100" style="background: linear-gradient(135deg, #10B981 0%, #059669 100%);">
                <div class="card__body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="icon-box" style="background-color: rgba(255,255,255,0.2);">
                            <i class="fas fa-comments text-white"></i>
                        </div>
                        <a href="{{ url_for('consultation.all_sessions') }}" class="text-white text-decoration-none">
                            <i class="fas fa-arrow-{{ 'left' if lang == 'ar' else 'right' }}"></i>
                        </a>
                    </div>
                    <h3 class="card__title text-white">{{ total_consultations }}</h3>
                    <p class="card__description text-white">
                        {{ 'جلسات الاستشارة' if lang == 'ar' else 'Consultations' }}
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Consulting Services Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4 class="fw-bold mb-1">
                        {{ 'الخدمات الاستشارية الذكية' if lang == 'ar' else 'Smart Consulting Services' }}
                    </h4>
                    <p class="text-muted mb-0">
                        {{ 'استكشف جميع الخدمات الاستشارية المتاحة لك' if lang == 'ar' else 'Explore all available consulting services' }}
                    </p>
                </div>
                <div>
                    <a href="{{ url_for('services.index') }}" class="btn btn-sm btn-outline-primary">
                        {{ 'عرض الكل' if lang == 'ar' else 'View All' }}
                        <i class="fas fa-arrow-{{ 'left' if lang == 'ar' else 'right' }} ms-1"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row g-4 mb-5">
        {% for service in all_services %}
        <div class="col-lg-3 col-md-6">
            <a href="{{ url_for('services.service_detail', service_slug=service.slug) }}" class="text-decoration-none">
                <div class="card card--feature hover-lift h-100">
                    <div class="card__body text-center">
                        <div class="icon-box {{ 'icon-box--primary' if loop.index % 2 == 1 else 'icon-box--secondary' }} mb-3">
                            <i class="fas {{ service.icon or 'fa-briefcase' }} fa-2x"></i>
                        </div>
                        <h6 class="card__title small">{{ service.title_ar if lang == 'ar' else service.title_en }}</h6>
                        <p class="card__description mb-0 small">
                            {{ service.description_ar[:60] + '...' if lang == 'ar' and service.description_ar and service.description_ar|length > 60 else (service.description_ar or '') if lang == 'ar' else (service.description_en[:60] + '...' if service.description_en and service.description_en|length > 60 else (service.description_en or '')) }}
                        </p>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
        
        <!-- Admin Panel (if system_admin) -->
        {% if user.role == 'system_admin' %}
        <div class="col-lg-3 col-md-6">
            <a href="{{ url_for('admin.index') }}" class="text-decoration-none">
                <div class="card card--feature hover-lift h-100" style="border: 2px solid var(--color-warning);">
                    <div class="card__body text-center">
                        <div class="icon-box mb-3" style="background-color: rgba(245, 158, 11, 0.1); color: var(--color-warning);">
                            <i class="fas fa-cog fa-2x"></i>
                        </div>
                        <h6 class="card__title small">{{ 'إدارة النظام' if lang == 'ar' else 'System Admin' }}</h6>
                        <p class="card__description mb-0 small">
                            {{ 'إدارة المستخدمين والنظام' if lang == 'ar' else 'Manage users and system' }}
                        </p>
                    </div>
                </div>
            </a>
        </div>
        {% endif %}
    </div>
    
    <!-- Recent Activity Section -->
    {% if recent_projects %}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card__header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card__title mb-0">
                            <i class="fas fa-history me-2"></i>
                            {{ 'المشاريع الأخيرة' if lang == 'ar' else 'Recent Projects' }}
                        </h5>
                        <a href="{{ url_for('dashboard.all_projects') }}" class="btn btn-sm btn-outline-primary">
                            {{ 'عرض الكل' if lang == 'ar' else 'View All' }}
                        </a>
                    </div>
                </div>
                <div class="card__body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>{{ 'العنوان' if lang == 'ar' else 'Title' }}</th>
                                    <th>{{ 'الوحدة' if lang == 'ar' else 'Module' }}</th>
                                    <th>{{ 'الحالة' if lang == 'ar' else 'Status' }}</th>
                                    <th>{{ 'التاريخ' if lang == 'ar' else 'Date' }}</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for project in recent_projects %}
                                <tr>
                                    <td>
                                        <strong>{{ project.title }}</strong>
                                    </td>
                                    <td>
                                        {% if project.id in project_services %}
                                            {% set service = project_services[project.id].service %}
                                            {% set offering = project_services[project.id].offering %}
                                            <div class="d-flex flex-column gap-1">
                                                <span class="badge badge--primary">
                                                    <i class="{{ service.icon }} me-1"></i>
                                                    {{ service.title_ar if lang == 'ar' else service.title_en }}
                                                </span>
                                                <span class="badge badge--secondary small">
                                                    {{ offering.title_ar if lang == 'ar' else offering.title_en }}
                                                </span>
                                            </div>
                                        {% else %}
                                            <span class="badge badge--primary">{{ project.module }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge badge--success">
                                            <i class="fas fa-check-circle me-1"></i>
                                            {{ project.status }}
                                        </span>
                                    </td>
                                    <td class="text-muted small">
                                        <i class="fas fa-calendar me-1"></i>
                                        {{ project.created_at.strftime('%Y-%m-%d') if project.created_at else 'N/A' }}
                                    </td>
                                    <td class="text-end">
                                        <a href="{{ url_for('services.view_project', project_id=project.id) }}" class="btn btn-sm btn-outline-primary" data-bs-toggle="tooltip" title="{{ 'معاينة' if lang == 'ar' else 'View' }}">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="row">
        <div class="col-12">
            <div class="card text-center py-5">
                <div class="card__body">
                    <div class="icon-box icon-box--primary mb-4 mx-auto" style="width: 5rem; height: 5rem;">
                        <i class="fas fa-rocket fa-3x"></i>
                    </div>
                    <h5 class="card__title">{{ 'ابدأ مشروعك الأول' if lang == 'ar' else 'Start Your First Project' }}</h5>
                    <p class="card__description mb-4">
                        {{ 'اختر أحد الوحدات الاستشارية أعلاه لبدء رحلتك نحو التميز' if lang == 'ar' else 'Choose one of the consulting modules above to start your excellence journey' }}
                    </p>
                    <a href="{{ url_for('consultation.index') }}" class="btn btn-primary">
                        <i class="fas fa-plus-circle me-2"></i>
                        {{ 'إنشاء مشروع جديد' if lang == 'ar' else 'Create New Project' }}
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
