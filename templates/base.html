<!DOCTYPE html>
<html lang="{{ 'ar' if lang == 'ar' else 'en' }}" dir="{{ 'rtl' if lang == 'ar' else 'ltr' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{% block title %}Mcidia - Smart AI. Agile. Excellence.{% endblock %}</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" async>
    
    <!-- FontAwesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" async>
    
    <!-- Google Fonts: Inter (English) and Cairo (Arabic) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom Design System -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/design-system.css') }}">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
    
    <style>
        .notifications-dropdown {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12) !important;
            border-radius: 8px !important;
            border: 1px solid #e8e8e8 !important;
        }
        
        .notification-item {
            border-bottom: 1px solid #f5f5f5;
            padding: 12px 15px !important;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            text-decoration: none;
            color: inherit !important;
        }
        
        .notification-item:hover {
            background-color: #f8f9fa !important;
            transform: translateX({{ '-2px' if lang == 'ar' else '2px' }});
        }
        
        .notification-item:last-of-type {
            border-bottom: none;
        }
        
        .notification-item-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: #1a1a1a;
            font-size: 0.95rem;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .notification-item-message {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 6px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .notification-item-time {
            font-size: 0.75rem;
            color: #999;
        }
        
        .notification-item-actions {
            position: absolute;
            {{ 'left' if lang == 'ar' else 'right' }}: 12px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 8px;
        }
        
        .notification-mark-read-btn {
            background: none;
            border: none;
            color: #0d6efd;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 4px 8px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .notification-mark-read-btn:hover {
            opacity: 1;
        }
        
        .mark-all-read-btn {
            width: 100% !important;
            border-radius: 0 0 8px 8px !important;
            text-align: center;
        }
        
        /* =======================================
           NAVBAR PROFESSIONAL STYLING v2.0
           Premium Design with Advanced Effects
           ======================================= */
        
        /* Navbar Base - Premium Styling */
        .navbar {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #ffffff 100%) !important;
            border-bottom: 2px solid transparent;
            background-image: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #ffffff 100%), 
                              linear-gradient(90deg, #e8e8f0, #e8e8f0);
            background-clip: padding-box, border-box;
            background-origin: padding-box, border-box;
            box-shadow: 0 4px 16px rgba(10, 39, 86, 0.06) !important;
            padding: 0.75rem 0 !important;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }
        
        .navbar::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #2767B1, transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .navbar:hover {
            box-shadow: 0 8px 24px rgba(10, 39, 86, 0.12) !important;
        }
        
        .navbar:hover::after {
            opacity: 1;
        }
        
        /* Navbar Brand - Premium */
        .navbar__brand {
            font-size: 1.5rem !important;
            font-weight: 700 !important;
            background: linear-gradient(135deg, #0A2756 0%, #2767B1 50%, #0A2756 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            letter-spacing: 0.3px;
        }
        
        .navbar__brand:hover {
            transform: translateY(-3px) scale(1.02);
            filter: drop-shadow(0 4px 12px rgba(39, 103, 177, 0.3));
        }
        
        .navbar__brand i {
            background: linear-gradient(135deg, #0A2756 0%, #2767B1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 2px 4px rgba(39, 103, 177, 0.2));
            transition: all 0.3s ease;
        }
        
        .navbar__brand:hover i {
            filter: drop-shadow(0 4px 8px rgba(39, 103, 177, 0.4));
        }
        
        /* Navbar Links - Enhanced */
        .navbar__link {
            position: relative;
            color: #0A2756 !important;
            font-weight: 500;
            padding: 0.5rem 1.1rem !important;
            margin: 0 0.3rem;
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .navbar__link::before {
            content: '';
            position: absolute;
            bottom: 0;
            {{ 'left' if lang == 'ar' else 'left' }}: 0;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, #2767B1, #0A2756);
            transition: width 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .navbar__link::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 20% 50%, rgba(39, 103, 177, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 8px;
        }
        
        .navbar__link:hover {
            background: linear-gradient(135deg, rgba(10, 39, 86, 0.08), rgba(39, 103, 177, 0.04)) !important;
            color: #2767B1 !important;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(39, 103, 177, 0.15);
        }
        
        .navbar__link:hover::before {
            width: 100%;
        }
        
        .navbar__link:hover::after {
            opacity: 1;
        }
        
        /* Icon styling - Animated */
        .navbar__link i {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: drop-shadow(0 1px 2px rgba(10, 39, 86, 0.1));
        }
        
        .navbar__link:hover i {
            transform: scale(1.15) rotate(5deg);
            filter: drop-shadow(0 2px 6px rgba(39, 103, 177, 0.3));
        }
        
        /* Navbar items styling */
        .nav-link {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .nav-link:hover {
            background-color: rgba(10, 39, 86, 0.06) !important;
        }
        
        /* Dropdown Toggle - Enhanced */
        .dropdown-toggle::after {
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
            border-color: currentColor !important;
        }
        
        .dropdown-toggle[aria-expanded="true"]::after {
            transform: rotate(180deg) !important;
        }
        
        /* Dropdown Menu - Premium */
        .navbar-nav .dropdown-menu {
            max-width: 320px;
            min-width: 220px;
            box-shadow: 0 16px 40px rgba(10, 39, 86, 0.18), 
                        0 4px 16px rgba(10, 39, 86, 0.1) !important;
            border: 1.5px solid #e8e8f0 !important;
            border-radius: 16px !important;
            animation: slideDown 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
            padding: 0 !important;
            overflow: hidden;
            backdrop-filter: blur(20px);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.95) 100%) !important;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-16px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .dropdown-menu .dropdown-item {
            padding: 14px 18px;
            font-size: 0.95rem;
            color: #0A2756;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            white-space: normal;
            word-wrap: break-word;
            border-{{ 'right' if lang == 'ar' else 'left' }}: 4px solid transparent;
            position: relative;
            font-weight: 500;
        }
        
        .dropdown-menu .dropdown-item::before {
            content: '';
            position: absolute;
            {{ 'right' if lang == 'ar' else 'left' }}: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, #2767B1, #0A2756);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .dropdown-menu .dropdown-item:hover {
            background: linear-gradient(90deg, rgba(39, 103, 177, 0.12) 0%, rgba(44, 140, 86, 0.06) 100%) !important;
            color: #2767B1 !important;
            border-{{ 'right' if lang == 'ar' else 'left' }}-color: #2767B1;
            padding-{{ 'right' if lang == 'ar' else 'left' }}: 22px;
            transform: translateX({{ '-3px' if lang == 'ar' else '3px' }});
            box-shadow: inset {{ '4px' if lang == 'ar' else '-4px' }} 0 8px rgba(39, 103, 177, 0.1);
        }
        
        .dropdown-menu .dropdown-item:hover::before {
            opacity: 1;
        }
        
        .dropdown-menu .dropdown-item.text-danger {
            color: #0A2756 !important;
        }
        
        .dropdown-menu .dropdown-item.text-danger:hover {
            background: linear-gradient(90deg, rgba(220, 38, 38, 0.12), transparent) !important;
            color: #dc2626 !important;
            border-{{ 'right' if lang == 'ar' else 'left' }}-color: #dc2626;
        }
        
        .dropdown-menu .dropdown-divider {
            margin: 10px 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #e8e8f0, transparent);
            opacity: 0.6;
        }
        
        /* Notification Badge - Premium */
        .notification-badge {
            animation: pulse 2.5s cubic-bezier(0.34, 1.56, 0.64, 1) infinite !important;
            background: linear-gradient(135deg, #dc3545, #e74c3c) !important;
            box-shadow: 0 0 12px rgba(220, 53, 69, 0.5) !important;
            font-weight: bold !important;
        }
        
        @keyframes pulse {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.8),
                            inset 0 0 4px rgba(255, 255, 255, 0.3);
            }
            50% {
                box-shadow: 0 0 0 8px rgba(220, 53, 69, 0),
                            inset 0 0 4px rgba(255, 255, 255, 0.1);
            }
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .navbar__brand {
                font-size: 1.25rem !important;
            }
            
            .navbar__link {
                padding: 0.5rem 0.75rem !important;
                margin: 0.25rem 0;
            }
            
            .navbar-nav .dropdown-menu {
                position: absolute !important;
                {{ 'left' if lang == 'ar' else 'right' }}: 0 !important;
                max-width: 300px;
                min-width: 200px;
            }
        }
        
        @media (max-width: 576px) {
            .navbar {
                padding: 0.5rem 0 !important;
            }
            
            .navbar__brand {
                font-size: 1.1rem !important;
            }
            
            .navbar__link {
                padding: 0.5rem 0.5rem !important;
                font-size: 0.9rem;
            }
            
            .notifications-dropdown {
                min-width: 280px !important;
                max-width: 90vw !important;
            }
            
            .navbar-nav .dropdown-menu {
                position: fixed !important;
                top: auto !important;
                {{ 'left' if lang == 'ar' else 'right' }}: 10px !important;
                max-width: calc(100vw - 20px) !important;
                min-width: auto !important;
                width: auto !important;
            }
        }
        
        /* Navbar Toggler Improvements */
        .navbar-toggler {
            transition: all 0.3s ease !important;
        }
        
        .navbar-toggler:hover {
            background-color: rgba(10, 39, 86, 0.05) !important;
        }
        
        .navbar-toggler:focus {
            box-shadow: 0 0 0 3px rgba(10, 39, 86, 0.1) !important;
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
{% if lang == 'ar' %}<body style="font-family: 'Cairo', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif">{% else %}<body style="font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif">{% endif %}
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container">
            <a class="navbar__brand navbar-brand" href="{{ url_for('main.index') }}">
                <i class="fas fa-brain me-2"></i>
                <span>Mcidia</span>
            </a>
            
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav {{ 'me-auto' if lang == 'en' else 'ms-auto' }} mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="navbar__link nav-link" href="{{ url_for('main.index') }}">
                            <i class="fas fa-home me-1"></i>
                            {{ 'الرئيسية' if lang == 'ar' else 'Home' }}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="navbar__link nav-link" href="{{ url_for('services.index') }}">
                            <i class="fas fa-cubes me-1"></i>
                            {{ 'الوحدات الاستشارية' if lang == 'ar' else 'Consulting Modules' }}
                        </a>
                    </li>
                    {% if current_user %}
                    <li class="nav-item">
                        <a class="navbar__link nav-link" href="{{ url_for('erp.index') }}">
                            <i class="fas fa-cogs me-1"></i>
                            {{ 'قسم ERP' if lang == 'ar' else 'ERP Section' }}
                        </a>
                    </li>
                    {% endif %}
                    <li class="nav-item">
                        <a class="navbar__link nav-link" href="{{ url_for('billing.pricing') }}">
                            <i class="fas fa-box me-1"></i>
                            {{ 'الأسعار' if lang == 'ar' else 'Pricing' }}
                        </a>
                    </li>
                    {% if current_user %}
                    <li class="nav-item">
                        <a class="navbar__link nav-link" href="{{ url_for('dashboard.index') }}">
                            <i class="fas fa-tachometer-alt me-1"></i>
                            {{ 'لوحة التحكم' if lang == 'ar' else 'Dashboard' }}
                        </a>
                    </li>
                    {% endif %}
                </ul>
                
                <ul class="navbar-nav align-items-lg-center">
                    <!-- User Notifications Icon - For Regular Users -->
                    {% if current_user and current_user.role != 'system_admin' %}
                    <li class="nav-item {{ 'ms-lg-2' if lang == 'en' else 'me-lg-2' }} dropdown">
                        <a class="navbar__link nav-link" href="#" id="userNotificationsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" title="{{ 'الإشعارات' if lang == 'ar' else 'Notifications' }}" style="position: relative; font-size: 1.25rem;">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="userNotificationBadge" style="position: absolute; top: -5px; {{ 'right' if lang == 'ar' else 'left' }}: -5px; background: #dc3545; color: white; border-radius: 50%; width: 20px; height: 20px; display: none; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold;">0</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end notifications-dropdown" id="userNotificationsMenu" aria-labelledby="userNotificationsDropdown" style="min-width: 350px; max-width: 450px;">
                            <div id="userNotificationsContent">
                                <div style="text-align: center; padding: 40px 20px; color: #999;">
                                    <i class="fas fa-bell-slash" style="font-size: 32px; margin-bottom: 12px; display: block; opacity: 0.4;"></i>
                                    <p style="margin: 0; font-size: 0.95rem;">{{ 'لا يوجد إشعارات' if lang == 'ar' else 'No notifications' }}</p>
                                </div>
                            </div>
                            <div id="userNotificationsFooter" style="border-top: 1px solid #f0f0f0; padding: 10px; display: flex; flex-direction: column; gap: 5px;">
                                <button class="dropdown-item mark-all-read-btn" id="userMarkAllReadBtn" style="font-size: 0.9rem; color: #0d6efd; display: none; border: none; background: none; cursor: pointer; text-align: center; padding: 8px 10px; width: 100%;">
                                    <i class="fas fa-check-double {{ 'ms-1' if lang == 'ar' else 'me-1' }}"></i>
                                    {{ 'تمييز الكل كمقروء' if lang == 'ar' else 'Mark all as read' }}
                                </button>
                                <a href="{{ url_for('user_notifications.index') }}" class="dropdown-item" style="text-align: center; font-size: 0.9rem; color: #0d6efd;">
                                    <i class="fas fa-arrow-left {{ 'ms-1' if lang == 'ar' else 'me-1' }}"></i>
                                    {{ 'عرض الكل' if lang == 'ar' else 'View All' }}
                                </a>
                            </div>
                        </div>
                    </li>
                    {% endif %}
                    
                    <!-- Notifications Icon - Admin Only -->
                    {% if current_user and current_user.role == 'system_admin' %}
                    <li class="nav-item {{ 'ms-lg-2' if lang == 'en' else 'me-lg-2' }} dropdown">
                        <a class="navbar__link nav-link" href="#" id="notificationsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" title="{{ 'الإشعارات' if lang == 'ar' else 'Notifications' }}" style="position: relative; font-size: 1.25rem;">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notificationBadge" style="position: absolute; top: -5px; {{ 'right' if lang == 'ar' else 'left' }}: -5px; background: #dc3545; color: white; border-radius: 50%; width: 20px; height: 20px; display: none; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold;">0</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end notifications-dropdown" id="notificationsMenu" aria-labelledby="notificationsDropdown" style="min-width: 350px; max-width: 450px;">
                            <div id="notificationsContent">
                                <div style="text-align: center; padding: 40px 20px; color: #999;">
                                    <i class="fas fa-bell-slash" style="font-size: 32px; margin-bottom: 12px; display: block; opacity: 0.4;"></i>
                                    <p style="margin: 0; font-size: 0.95rem;">{{ 'لا يوجد إشعارات' if lang == 'ar' else 'No notifications' }}</p>
                                </div>
                            </div>
                            <div id="notificationsFooter" style="border-top: 1px solid #f0f0f0; padding: 10px; display: flex; flex-direction: column; gap: 5px;">
                                <button class="dropdown-item mark-all-read-btn" id="markAllReadBtn" style="font-size: 0.9rem; color: #0d6efd; display: none;">
                                    <i class="fas fa-check-double {{ 'ms-1' if lang == 'ar' else 'me-1' }}"></i>
                                    {{ 'تمييز الكل كمقروء' if lang == 'ar' else 'Mark all as read' }}
                                </button>
                                <a href="{{ url_for('admin.notifications_admin.index') }}" class="dropdown-item" style="text-align: center; font-size: 0.9rem; color: #0d6efd;">
                                    <i class="fas fa-arrow-left {{ 'ms-1' if lang == 'ar' else 'me-1' }}"></i>
                                    {{ 'عرض الكل' if lang == 'ar' else 'View All' }}
                                </a>
                            </div>
                        </div>
                    </li>
                    {% endif %}
                    
                    <!-- Language Switcher -->
                    <li class="nav-item dropdown">
                        <a class="navbar__link nav-link dropdown-toggle" href="#" id="langDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-globe me-1"></i>
                            {{ 'العربية' if lang == 'ar' else 'English' }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="langDropdown">
                            <li>
                                <a class="dropdown-item" href="{{ url_for('main.set_language', lang='ar') }}">
                                    <i class="fas fa-language me-2"></i>العربية
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{{ url_for('main.set_language', lang='en') }}">
                                    <i class="fas fa-language me-2"></i>English
                                </a>
                            </li>
                        </ul>
                    </li>
                    
                    {% if current_user %}
                    <!-- User Menu (Logged In) -->
                    <li class="nav-item dropdown">
                        <a class="navbar__link nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user-circle me-1"></i>
                            {{ current_user.username if current_user.username else 'User' }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li>
                                <a class="dropdown-item" href="{{ url_for('dashboard.index') }}">
                                    <i class="fas fa-tachometer-alt me-2"></i>
                                    {{ 'لوحة التحكم' if lang == 'ar' else 'Dashboard' }}
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{{ url_for('billing.index') }}">
                                    <i class="fas fa-credit-card me-2"></i>
                                    {{ 'الفواتير' if lang == 'ar' else 'Billing' }}
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{{ url_for('profile.settings') }}">
                                    <i class="fas fa-user-cog me-2"></i>
                                    {{ 'إعدادات الملف الشخصي' if lang == 'ar' else 'Profile Settings' }}
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}">
                                    <i class="fas fa-sign-out-alt me-2"></i>
                                    {{ 'تسجيل الخروج' if lang == 'ar' else 'Logout' }}
                                </a>
                            </li>
                        </ul>
                    </li>
                    {% else %}
                    <!-- Auth Buttons (Not Logged In) -->
                    <li class="nav-item {{ 'ms-lg-2' if lang == 'en' else 'me-lg-2' }}">
                        <a class="navbar__link nav-link" href="{{ url_for('auth.login') }}">
                            {{ 'تسجيل الدخول' if lang == 'ar' else 'Login' }}
                        </a>
                    </li>
                    <li class="nav-item {{ 'ms-lg-2' if lang == 'en' else 'me-lg-2' }}">
                        <a class="btn btn-primary" href="{{ url_for('auth.register') }}">
                            <i class="fas fa-rocket me-1"></i>
                            {{ 'ابدأ الآن' if lang == 'ar' else 'Get Started' }}
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="container mt-4">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show animate-fadeIn" role="alert">
                        <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-triangle' }} me-2"></i>
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row g-4">
                <!-- Brand Column -->
                <div class="col-lg-4 col-md-6">
                    <h5 class="footer__title mb-4">
                        <i class="fas fa-brain me-2"></i>
                        Mcidia
                    </h5>
                    <p class="footer__description text-white-50 mb-4">
                        {{ 'منصة استشارية ذكية متكاملة تعتمد على الذكاء الاصطناعي لتحقيق التميز المؤسسي وتطوير الأعمال.' if lang == 'ar' else 'Smart AI-powered consulting platform for organizational excellence and business development.' }}
                    </p>
                    <div class="social-links">
                        <a href="#" class="footer__link d-inline-block me-3">
                            <i class="fab fa-linkedin fa-lg"></i>
                        </a>
                        <a href="#" class="footer__link d-inline-block me-3">
                            <i class="fab fa-twitter fa-lg"></i>
                        </a>
                        <a href="#" class="footer__link d-inline-block">
                            <i class="fab fa-facebook fa-lg"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Quick Links Column -->
                <div class="col-lg-2 col-md-6">
                    <h6 class="footer__title mb-4">
                        {{ 'روابط سريعة' if lang == 'ar' else 'Quick Links' }}
                    </h6>
                    <ul class="list-unstyled">
                        <li><a href="{{ url_for('main.index') }}" class="footer__link">{{ 'الرئيسية' if lang == 'ar' else 'Home' }}</a></li>
                        <li><a href="{{ url_for('services.index') }}" class="footer__link">{{ 'الوحدات الاستشارية' if lang == 'ar' else 'Consulting Modules' }}</a></li>
                        <li><a href="{{ url_for('billing.pricing') }}" class="footer__link">{{ 'الأسعار' if lang == 'ar' else 'Pricing' }}</a></li>
                        <li><a href="{{ url_for('dashboard.index') }}" class="footer__link">{{ 'لوحة التحكم' if lang == 'ar' else 'Dashboard' }}</a></li>
                    </ul>
                </div>
                
                <!-- Services Column -->
                <div class="col-lg-3 col-md-6">
                    <h6 class="footer__title mb-4">
                        {{ 'الوحدات الاستشارية' if lang == 'ar' else 'Consulting Modules' }}
                    </h6>
                    <ul class="list-unstyled">
                        <li><a href="{{ url_for('strategy.index') }}" class="footer__link">{{ 'التخطيط الاستراتيجي' if lang == 'ar' else 'Strategy' }}</a></li>
                        <li><a href="{{ url_for('hr.index') }}" class="footer__link">{{ 'الموارد البشرية' if lang == 'ar' else 'HR' }}</a></li>
                        <li><a href="{{ url_for('finance.index') }}" class="footer__link">{{ 'المالية' if lang == 'ar' else 'Finance' }}</a></li>
                        <li><a href="{{ url_for('marketing.index') }}" class="footer__link">{{ 'التسويق' if lang == 'ar' else 'Marketing' }}</a></li>
                    </ul>
                </div>
                
                <!-- Contact Column -->
                <div class="col-lg-3 col-md-6">
                    <h6 class="footer__title mb-4">
                        {{ 'تواصل معنا' if lang == 'ar' else 'Contact Us' }}
                    </h6>
                    <ul class="list-unstyled text-white-50">
                        <li class="mb-2">
                            <i class="fas fa-envelope me-2"></i>
                            <a href="mailto:info@mcidia.com" class="footer__link">info@mcidia.com</a>
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-phone me-2"></i>
                            <a href="tel:+966501234567" class="footer__link">+966 50 123 4567</a>
                        </li>
                        <li>
                            <i class="fas fa-map-marker-alt me-2"></i>
                            {{ 'الرياض، المملكة العربية السعودية' if lang == 'ar' else 'Riyadh, Saudi Arabia' }}
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Footer Bottom -->
            <hr class="my-4 bg-white opacity-25">
            <div class="row">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    <p class="text-white-50 mb-0 small">
                        &copy; 2025 Mcidia. {{ 'جميع الحقوق محفوظة' if lang == 'ar' else 'All rights reserved.' }}
                    </p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <p class="text-white-50 mb-0 small">
                        <strong>Smart AI. Agile. Excellence.</strong>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SweetAlert2 for beautiful alerts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <!-- Custom Scripts -->
    <script>
        // Navbar scroll effect
        window.addEventListener('scroll', function() {
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('navbar--scrolled');
            } else {
                navbar.classList.remove('navbar--scrolled');
            }
        });
        
        // Auto-dismiss alerts after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert:not(.alert-permanent)');
            alerts.forEach(function(alert) {
                setTimeout(function() {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }, 5000);
            });
        });
        
        // Notifications badge visibility and dropdown loading
        function updateNotificationBadge(count) {
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                if (count > 0) {
                    badge.style.display = 'flex';
                    badge.textContent = count;
                } else {
                    badge.style.display = 'none';
                }
            }
        }
        
        // User notifications badge visibility
        function updateUserNotificationBadge(count) {
            const badge = document.getElementById('userNotificationBadge');
            if (badge) {
                if (count > 0) {
                    badge.style.display = 'flex';
                    badge.textContent = count;
                } else {
                    badge.style.display = 'none';
                }
            }
        }
        
        // Mark notification as read
        function markNotificationRead(notificationId) {
            fetch('/admin/notifications/mark-read/' + notificationId, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    loadAdminNotifications();
                }
            })
            .catch(error => console.log('Error marking notification as read'));
        }
        
        // Mark all notifications as read
        function markAllNotificationsRead() {
            fetch('/admin/notifications/mark-all-read', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    loadAdminNotifications();
                }
            })
            .catch(error => console.log('Error marking all notifications as read'));
        }
        
        // Load admin notifications
        function loadAdminNotifications() {
            // Check if user is admin (check if notifications icon exists)
            const notificationIcon = document.getElementById('notificationsDropdown');
            if (!notificationIcon) return;
            
            fetch('/admin/notifications/api')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.count > 0) {
                        updateNotificationBadge(data.count);
                        document.getElementById('markAllReadBtn').style.display = 'block';
                        
                        const notificationsContent = document.getElementById('notificationsContent');
                        let html = '';
                        
                        data.data.slice(0, 5).forEach(notification => {
                            const createdDate = new Date(notification.created_at);
                            const now = new Date();
                            let dateStr = '';
                            
                            const diffMs = now - createdDate;
                            const diffMins = Math.floor(diffMs / 60000);
                            const diffHours = Math.floor(diffMs / 3600000);
                            const diffDays = Math.floor(diffMs / 86400000);
                            
                            if (diffMins < 1) {
                                dateStr = '{{ "للتو" if lang == "ar" else "Just now" }}';
                            } else if (diffMins < 60) {
                                dateStr = diffMins + ' {{ "دقيقة" if lang == "ar" else "min" }} {{ "مضت" if lang == "ar" else "ago" }}';
                            } else if (diffHours < 24) {
                                dateStr = diffHours + ' {{ "ساعة" if lang == "ar" else "hour" }} {{ "مضت" if lang == "ar" else "ago" }}';
                            } else if (diffDays < 7) {
                                dateStr = diffDays + ' {{ "يوم" if lang == "ar" else "day" }} {{ "مضت" if lang == "ar" else "ago" }}';
                            } else {
                                dateStr = createdDate.toLocaleDateString('{{ "ar-SA" if lang == "ar" else "en-US" }}', {
                                    month: 'short',
                                    day: 'numeric'
                                });
                            }
                            
                            const messagePreview = notification.message.substring(0, 85) + (notification.message.length > 85 ? '...' : '');
                            
                            html += `
                                <div class="notification-item" style="position: relative; padding-{{ 'left' if lang == 'ar' else 'right' }}: 45px !important;">
                                    <a href="{{ url_for('admin.notifications_admin.index') }}" style="text-decoration: none; color: inherit; display: block;">
                                        <div class="notification-item-title">${notification.title}</div>
                                        <div class="notification-item-message">${messagePreview}</div>
                                        <div class="notification-item-time">${dateStr}</div>
                                    </a>
                                    <div class="notification-item-actions">
                                        <button class="notification-mark-read-btn" onclick="event.preventDefault(); event.stopPropagation(); markNotificationRead(${notification.id});" title="{{ 'تمييز كمقروء' if lang == 'ar' else 'Mark as read' }}">
                                            <i class="fas fa-check"></i>
                                        </button>
                                    </div>
                                </div>
                            `;
                        });
                        
                        notificationsContent.innerHTML = html;
                    } else {
                        updateNotificationBadge(0);
                        document.getElementById('markAllReadBtn').style.display = 'none';
                    }
                })
                .catch(error => {
                    console.log('Could not load notifications');
                });
        }
        
        // Add click handler for mark all read button
        document.addEventListener('DOMContentLoaded', function() {
            const markAllReadBtn = document.getElementById('markAllReadBtn');
            if (markAllReadBtn) {
                markAllReadBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    markAllNotificationsRead();
                });
            }
            
            const userMarkAllReadBtn = document.getElementById('userMarkAllReadBtn');
            if (userMarkAllReadBtn) {
                userMarkAllReadBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    markAllUserNotificationsRead();
                });
            }
        });
        
        // Mark all user notifications as read
        function markAllUserNotificationsRead() {
            fetch('/user/notifications/mark-all-read', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateUserNotificationBadge(0);
                    document.getElementById('userMarkAllReadBtn').style.display = 'none';
                    loadUserNotifications();
                }
            })
            .catch(error => console.log('Error marking all user notifications as read'));
        }
        
        // Load user notifications
        function loadUserNotifications() {
            // Check if user notifications icon exists
            const userNotificationIcon = document.getElementById('userNotificationsDropdown');
            if (!userNotificationIcon) return;
            
            fetch('/user/notifications/api')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const count = data.count || 0;
                        updateUserNotificationBadge(count);
                        
                        if (count > 0) {
                            const userNotificationsContent = document.getElementById('userNotificationsContent');
                            let html = '';
                            
                            data.data.slice(0, 5).forEach(notification => {
                                const createdDate = new Date(notification.created_at);
                                const now = new Date();
                                let dateStr = '';
                                
                                const diffMs = now - createdDate;
                                const diffMins = Math.floor(diffMs / 60000);
                                const diffHours = Math.floor(diffMs / 3600000);
                                const diffDays = Math.floor(diffMs / 86400000);
                                
                                if (diffMins < 1) {
                                    dateStr = '{{ "للتو" if lang == "ar" else "Just now" }}';
                                } else if (diffMins < 60) {
                                    dateStr = diffMins + ' {{ "دقيقة" if lang == "ar" else "min" }} {{ "مضت" if lang == "ar" else "ago" }}';
                                } else if (diffHours < 24) {
                                    dateStr = diffHours + ' {{ "ساعة" if lang == "ar" else "hour" }} {{ "مضت" if lang == "ar" else "ago" }}';
                                } else if (diffDays < 7) {
                                    dateStr = diffDays + ' {{ "يوم" if lang == "ar" else "day" }} {{ "مضت" if lang == "ar" else "ago" }}';
                                } else {
                                    dateStr = createdDate.toLocaleDateString('{{ "ar-SA" if lang == "ar" else "en-US" }}', {
                                        month: 'short',
                                        day: 'numeric'
                                    });
                                }
                                
                                const messagePreview = notification.title.substring(0, 85) + (notification.title.length > 85 ? '...' : '');
                                
                                html += `
                                    <div class="notification-item" style="position: relative; padding-{{ 'left' if lang == 'ar' else 'right' }}: 45px !important;">
                                        <a href="{{ url_for('user_notifications.index') }}" style="text-decoration: none; color: inherit; display: block;">
                                            <div class="notification-item-title">${notification.title}</div>
                                            <div class="notification-item-time">${dateStr}</div>
                                        </a>
                                    </div>
                                `;
                            });
                            
                            userNotificationsContent.innerHTML = html;
                            document.getElementById('userMarkAllReadBtn').style.display = 'block';
                        } else {
                            updateUserNotificationBadge(0);
                            document.getElementById('userMarkAllReadBtn').style.display = 'none';
                        }
                    }
                })
                .catch(error => {
                    console.log('Could not load user notifications', error);
                });
        }
        
        // Initialize notification badge and load notifications on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateNotificationBadge(0);
            updateUserNotificationBadge(0);
            loadAdminNotifications();
            loadUserNotifications();
            
            // Reload notifications immediately after 500ms and then every 30 seconds
            setTimeout(loadAdminNotifications, 500);
            setTimeout(loadUserNotifications, 500);
            setInterval(loadAdminNotifications, 30000);
            setInterval(loadUserNotifications, 30000);
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
